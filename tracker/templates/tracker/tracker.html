{% extends "base.html" %} 
{% block content %}
<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 m-0">Tracker</h1>
    {% if user.is_authenticated %}
      <a class="btn btn-outline-primary" href="{% url 'export_csv' %}">Export CSV</a>
    {% endif %}
  </div>
<div class="container my-4">
  <h2>{{ month }}/{{ year }} Cycle Log</h2>
  <form method="post">
    {% csrf_token %}
    <table class="table table-bordered text-center">
      <thead>
        <tr>
          <th>Sun</th>
          <th>Mon</th>
          <th>Tue</th>
          <th>Wed</th>
          <th>Thu</th>
          <th>Fri</th>
          <th>Sat</th>
        </tr>
      </thead>
      <tbody>
        {% for week in month_days %}
        <tr>
          {% for day in week %}
          <td class="{% if day.month != month %}text-muted{% endif %}">
            <div>
              <small>{{ day.day }}</small><br />
              {% if day.month == month %}
              <input
                type="checkbox"
                class="log-checkbox"
                name="log_days"
                value="{{ day }}"
                title="Log this day"
                {%
                if
                day
                in
                logged_dates
                %}checked{%
                endif
                %}
              />
              {% endif %}
            </div>
          </td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="mt-4">
      <a href="{% url 'submit_log' %}" class="btn btn-primary">Submit Log</a>
    </div>
    <button id="log-flow-btn" type="submit" class="btn btn-danger mt-2 d-none">
      Log Flow
    </button>
  </form>
</div>

<script>
  const checkboxes = document.querySelectorAll(".log-checkbox");
  const logFlowBtn = document.getElementById("log-flow-btn");

  function toggleLogFlowButton() {
    const checkedCount = Array.from(checkboxes).filter(
      (cb) => cb.checked
    ).length;
    logFlowBtn.classList.toggle("d-none", checkedCount < 2);
  }

  checkboxes.forEach((cb) =>
    cb.addEventListener("change", toggleLogFlowButton)
  );
  toggleLogFlowButton();
</script>

{% endblock %}
