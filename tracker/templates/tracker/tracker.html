{% extends "base.html" %} {% block content %}
<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 m-0">Tracker</h1>
    {% if user.is_authenticated %}
    <a class="btn btn-outline-primary" href="{% url 'export_csv' %}"
      >Export CSV</a
    >
    {% endif %}
  </div>
  <div class="container my-4">
    <h2>{{ month }}/{{ year }} Cycle Log</h2>
    <td class="calendar-day" data-date="{{ day|date:'Y-m-d' }}">
      <button type="button" class="btn btn-sm w-100">{{ day|date:'j' }}</button>
    </td>
    <div class="d-flex flex-wrap align-items-center gap-3 mb-3">
      <div id="selected-date" class="text-muted small">No date selected.</div>
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="multi-select" />
        <label class="form-check-label" for="multi-select"
          >Select multiple days</label
        >
      </div>
    </div>
    <form id="cycle-log-form" method="post" action="{% url 'submit_log' %}" class="row g-3">
  {% csrf_token %}
  <input type="hidden" name="date" id="id_date">
    <div id="multi-date-container"></div>
      <table class="table table-bordered text-center">
        <thead>
          <tr>
            <th>Sun</th>
            <th>Mon</th>
            <th>Tue</th>
            <th>Wed</th>
            <th>Thu</th>
            <th>Fri</th>
            <th>Sat</th>
          </tr>
        </thead>
        <tbody>
          {% for week in month_days %}
          <tr>
            {% for day in week %}
            <td class="{% if day.month != month %}text-muted{% endif %}">
              <div>
                <small>{{ day.day }}</small><br />
                {% if day.month == month %}
                <input
                  type="checkbox"
                  class="log-checkbox"
                  name="log_days"
                  value="{{ day }}"
                  title="Log this day"
                  {%
                  if
                  day
                  in
                  logged_dates
                  %}checked{%
                  endif
                  %}
                />
                {% endif %}
              </div>
            </td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <div class="mt-4">
        <a href="{% url 'submit_log' %}" class="btn btn-primary">Submit Log</a>
      </div>
      <div class="mt-2">
      <button
        id="log-flow-btn"
        type="submit"
        class="btn btn-danger mt-2 d-none"
      >
        Log Flow
      </button>
      </div>
    </form>
    <table class="table" aria-label="Cycle logs">
      <caption>
        Your recent cycle logs
      </caption>
      <thead>
        <tr>
          <th scope="col">Date</th>
          <th scope="col">Symptoms</th>
          <th scope="col">Notes</th>
        </tr>
      </thead>
      <tbody>
        {% for log in logs %}
        <tr>
          <td>{{ log.date }}</td>
          <td>{{ log.symptom }}</td>
          <td>{{ log.notes }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <script>
    const checkboxes = document.querySelectorAll(".log-checkbox");
    const logFlowBtn = document.getElementById("log-flow-btn");

    function toggleLogFlowButton() {
      const checkedCount = Array.from(checkboxes).filter(
        (cb) => cb.checked
      ).length;
      logFlowBtn.classList.toggle("d-none", checkedCount < 2);
    }

    checkboxes.forEach((cb) =>
      cb.addEventListener("change", toggleLogFlowButton)
    );
    toggleLogFlowButton();
  </script>

  {% endblock %}
</div>
